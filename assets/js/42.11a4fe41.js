(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{374:function(s,a,t){"use strict";t.r(a);var e=t(8),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"后端部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端部署"}},[s._v("#")]),s._v(" 后端部署")]),s._v(" "),a("p",[s._v("打包之前，需要检查数据库、Redis等配置是否为线上环境")]),s._v(" "),a("h3",{attrs:{id:"打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[s._v("#")]),s._v(" 打包")]),s._v(" "),a("p",[s._v("项目根目录使用如下maven命令打包：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mvn clean package\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果使用的是IDEA工具，右上角的 "),a("code",[s._v("Maven -> Lifecycle")]),s._v(" 中，依次点击 "),a("code",[s._v("clean")]),s._v(" "),a("code",[s._v("package")])]),s._v(" "),a("p",[s._v("之后在 "),a("code",[s._v("campus-modular")]),s._v(" 模块 target 目录，可看到打好的jar包")]),s._v(" "),a("h3",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),a("p",[s._v("需安装好需要的环境")]),s._v(" "),a("p",[s._v("在jar包目录下，启动命令：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" campus-modular.jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" campus_log.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动之后在当前目录的 "),a("code",[s._v("campus_log.log")]),s._v(" 是启动日志")]),s._v(" "),a("h3",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),a("p",[s._v("如果提示当前权限不足，无法写入文件请检查文件上传的路径，是否有可读可写操作权限")]),s._v(" "),a("h2",{attrs:{id:"前端部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端部署"}},[s._v("#")]),s._v(" 前端部署")]),s._v(" "),a("h3",{attrs:{id:"打包-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包-2"}},[s._v("#")]),s._v(" 打包")]),s._v(" "),a("p",[s._v("命令如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包正式环境")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build:prod\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包预发布环境")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build:stage\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("包成功之后，会在根目录生成 "),a("code",[s._v("dist")]),s._v(" 文件夹，里面就是构建打包好的文件")]),s._v(" "),a("p",[s._v("通常情况下 "),a("code",[s._v("dist")]),s._v(" 文件夹的静态文件发布到你的 nginx 或者静态服务器即可，其中的 "),a("code",[s._v("index.html")]),s._v(" 是后台服务的入口页面。")]),s._v(" "),a("h3",{attrs:{id:"nginx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[s._v("#")]),s._v(" Nginx配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("worker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    server {\n        listen       80;\n        server_name  localhost;\n\t\tcharset utf-8;\n\n\t\tlocation / {\n            root   /www/wwwroot/xxxxx.com/dist;\n\t\t\ttry_files $uri $uri/ /index.html;\n            index  index.html index.htm;\n        }\n\t\t\n\t\tlocation /prod-api/ {\n\t\t\tproxy_set_header Host $http_host;\n\t\t\tproxy_set_header X-Real-IP $remote_addr;\n\t\t\tproxy_set_header REMOTE-HOST $remote_addr;\n\t\t\tproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\t\tproxy_pass http://localhost:8160/;\n\t\t}\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("若你使用 "),a("code",[s._v("宝塔")]),s._v(" 部署，添加站点后，只需在最后添加以下 nginx 配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location / {\n\troot   /www/wwwroot/xxxxx.com/dist;\n\ttry_files $uri $uri/ /index.html;\n\tindex  index.html index.htm;\n}\n\t\t\nlocation /prod-api/ {\n\tproxy_set_header Host $http_host;\n\tproxy_set_header X-Real-IP $remote_addr;\n\tproxy_set_header REMOTE-HOST $remote_addr;\n\tproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\tproxy_pass http://localhost:8160/;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"docker后端部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker后端部署"}},[s._v("#")]),s._v(" Docker后端部署")]),s._v(" "),a("p",[s._v("配合IDEA里的Docker功能，可快速方便部署")]),s._v(" "),a("h3",{attrs:{id:"idea环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#idea环境配置"}},[s._v("#")]),s._v(" IDEA环境配置")]),s._v(" "),a("p",[s._v("打开  "),a("code",[s._v("服务窗口")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221232742914.png",alt:"image-20231221232742914"}})]),s._v(" "),a("p",[s._v("识别到本项目里的Docker执行配置文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221232659657.png",alt:"image-20231221232659657"}})]),s._v(" "),a("p",[s._v("点击 + 号添加，搜索Docker")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221232900877.png",alt:"image-20231221232900877"}})]),s._v(" "),a("p",[s._v("若没有识别到，可自己手动添加识别")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221233426905.png",alt:"image-20231221233426905"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221233518312.png",alt:"image-20231221233518312"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221233456292.png",alt:"image-20231221233456292"}})]),s._v(" "),a("p",[s._v("配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221232507853.png",alt:"image-20231221232507853"}})]),s._v(" "),a("p",[s._v("选择Server，若没有则添加（在Server里有 Create new）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221232958651.png",alt:"image-20231221232958651"}})]),s._v(" "),a("p",[s._v("建议选择 "),a("code",[s._v("SSH")]),s._v(" 连接")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221233114192.png",alt:"image-20231221233114192"}})]),s._v(" "),a("p",[s._v("ssh配置里连接方式建议选择 "),a("code",[s._v("Key pair")]),s._v(" （IDEA 2023.3.1要求，低版本可使用账号密码）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221233158152.png",alt:"image-20231221233158152"}})]),s._v(" "),a("h3",{attrs:{id:"开始构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始构建"}},[s._v("#")]),s._v(" 开始构建")]),s._v(" "),a("ul",[a("li",[s._v("1、Docker目录上传到服务器根目录")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221232029237.png",alt:"image-20231221232029237"}})]),s._v(" "),a("p",[s._v("给docker分配文件夹权限")]),s._v(" "),a("p",[s._v("一定要分配权限，"),a("strong",[s._v("确保目录 "),a("code",[s._v("/docker")]),s._v(" 及其所有子目录具有写权限")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("2、构建镜像")])]),s._v(" "),a("p",[s._v("IDEA 中需要先使用maven打包成jar包")]),s._v(" "),a("p",[s._v("install package都可以")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221234255447.png",alt:"image-20231221234255447"}})]),s._v(" "),a("p",[s._v("执行构建前需配置好docker连接之后")]),s._v(" "),a("p",[s._v("运行如下即可构建对应的应用镜像")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221234442597.png",alt:"image-20231221234442597"}})]),s._v(" "),a("p",[s._v("构建成功后的镜像及日志")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221234620612.png",alt:"image-20231221234620612"}})]),s._v(" "),a("h3",{attrs:{id:"运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),a("p",[s._v("在之前上传的 "),a("code",[s._v("docker")]),s._v(" 下执行")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hcss-ecs-a963 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hcss-ecs-a963 docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose up -d campus-server")]),s._v("\nCreating campus-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hcss-ecs-a963 docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("启动成功后")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221234959682.png",alt:"image-20231221234959682"}})]),s._v(" "),a("p",[s._v("为了测试我是在docker中运行了 mysql redis，这俩服务需要在 "),a("code",[s._v("campus-server")]),s._v(" 之前启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mysql redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("若不在docker启动 "),a("code",[s._v("mysql")]),s._v(" "),a("code",[s._v("redis")]),s._v("，需要挂载使用外部配置文件")])])]),s._v(" "),a("p",[s._v("1、在 "),a("code",[s._v("/docker/server/conf")]),s._v(" 创建 "),a("code",[s._v("application-prod.yml")]),s._v(" 文件")]),s._v(" "),a("p",[s._v("修改对应的mysql redis连接配置")]),s._v(" "),a("p",[s._v("2、docker启动中添加环境")]),s._v(" "),a("p",[a("code",[s._v("spring.config.additional-location: /home/campus/conf/application-prod.yml")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231221235823864.png",alt:"image-20231221235823864"}})]),s._v(" "),a("p",[s._v("之后重启容器")]),s._v(" "),a("p",[s._v("我这里修改了数据库名导致启动识别，证明已经使用了外部配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/oddfar/static/campus/15.%E9%83%A8%E7%BD%B2%E7%B3%BB%E7%BB%9F.assets/image-20231222000049739.png",alt:"image-20231222000049739"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);